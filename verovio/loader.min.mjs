import{loadScript as o}from"../library-loader.min.mjs";export function loadVerovio(){return window.__verovioToolkit?Promise.resolve(window.__verovioToolkit):o("Verovio","https://www.verovio.org/javascript/latest/verovio-toolkit-wasm.js").then(()=>new Promise((o,e)=>{let r=Date.now();!function i(){if(window.verovio&&verovio.module){let l=verovio.module;if(l.onRuntimeInitialized=()=>{try{let r=new verovio.toolkit;window.__verovioToolkit=r,console.log("[verovio-loader] WASM 初期化完了, Toolkit 作成"),o(r)}catch(i){console.error("[verovio-loader] Toolkit の生成でエラー",i),e(i)}},l.calledRun)try{let t=new verovio.toolkit;window.__verovioToolkit=t,console.log("[verovio-loader] 既に run 済み, Toolkit 作成"),o(t)}catch(v){console.error("[verovio-loader] 既存 run からの生成エラー",v),e(v)}}else if(Date.now()-r>2e4){let n="[verovio-loader] module が初期化されませんでした（タイムアウト）";console.error(n),e(Error(n))}else setTimeout(i,100)}()}))}