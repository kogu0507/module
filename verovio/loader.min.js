import{loadScript as o}from"../library-loader.min.js";let cachedToolkit=null;export async function loadVerovio({scriptUrl:e="https://www.verovio.org/javascript/latest/verovio-toolkit-wasm.js",timeout:t=2e4,pollingInterval:i=100}={}){if(cachedToolkit)return cachedToolkit;try{await o("Verovio",e)}catch(l){throw Error(`Verovio スクリプトの読み込みに失敗しました: ${l.message}`)}let r=await new Promise((o,e)=>{let l=Date.now();!function r(){if(window.verovio&&window.verovio.module){let a=window.verovio.module,v=()=>{try{let t=new window.verovio.toolkit;cachedToolkit=t,o(t)}catch(i){e(Error(`Toolkit インスタンス生成エラー: ${i.message}`))}};a.calledRun?v():a.onRuntimeInitialized=v}else Date.now()-l>t?e(Error("Verovio モジュールの初期化がタイムアウトしました")):setTimeout(r,i)}()});return console.log("[verovio-loader] Toolkit が初期化されました"),r}