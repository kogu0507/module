import{loadVerovio as r}from"./loader.min.js";import{CoreProcessor as e}from"./core-processor.min.js";import{ScoreUIHandler as s}from"./score-ui-handler.min.js";import{Transposer as t}from"./transposer.min.js";export class VerovioManager{#a=null;#b=null;#c=null;#d=null;constructor(){}async initialize(){if(this.#a){console.warn("既に初期化済みです。");return}try{this.#a=await r(),this.#b=new e(this.#a),this.#c=new s,this.#d=new t(this.#a),console.log("VerovioManager の初期化が完了しました。")}catch(o){throw console.error("初期化中にエラーが発生しました:",o),o}}setRenderOptions(r){this.#e(),this.#b.setRenderOptions(r)}async displayMeiOnElement(r,e){this.#e(),this.#c.showLoading(e);try{let s=await this.#b.renderSvgFromUrl(r);this.#c.displaySvg(s,e)}catch(t){console.error("表示エラー:",t),this.#c.showError("楽譜の表示に失敗しました。",e)}}async displayTransposedMeiOnElement(r,e,s){this.#e(),this.#c.showLoading(e);try{let t=await fetch(r);if(!t.ok)throw Error(`${t.status} ${t.statusText}`);let o=await t.text(),i=await this.#d.transposeMei(o,s),n=this.#b.renderSvgFromMei(i);this.#c.displaySvg(n,e)}catch(a){console.error("移調表示エラー:",a),this.#c.showError("移調表示に失敗しました。",e)}}async getMidiFromMei(r){return this.#e(),this.#b.renderMidiFromUrl(r)}#e(){if(!this.#a)throw Error("initialize() を先に呼び出してください。")}}