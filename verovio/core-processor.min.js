import{loadVerovio as t}from"./loader.min.js";export class CoreProcessor{#a;#b={};#c=null;constructor(t){if(!t)throw Error("Verovio Toolkit インスタンスが必要です。");this.#a=t,this.#a.setOptions(this.#b)}static async #d(e){let r=await fetch(e);if(!r.ok)throw Error(`MEI の取得に失敗: ${r.status} ${r.statusText}`);return r.text()}setRenderOptions(t){this.#b={...this.#b,...t},this.#a.setOptions(this.#b)}getCurrentMeiData(){return this.#c}async #e(i){this.#a.select({measureRange:i}),await this.#a.redoLayout()}async renderSvgFromMei(t,{page:e=1,measureRange:r="start-end"}={}){return this.#c=t,this.#a.loadData(t),await this.#e(r),this.#a.renderToSVG(e)}async renderSvgFromUrl(t,e){let r=await CoreProcessor.#d(t);return this.renderSvgFromMei(r,e)}async renderCurrentSvg({page:t=1,measureRange:e="start-end"}={}){if(!this.#c)throw Error("MEI データがロードされていません。");return await this.#e(e),this.#a.renderToSVG(t)}static #f(o){let s=atob(o),a=s.length,n=new Uint8Array(a);for(let d=0;d<a;d++)n[d]=s.charCodeAt(d);return n.buffer}renderMidiFromMei(t){this.#c=t,this.#a.loadData(t);let e=this.#a.renderToMIDI();return CoreProcessor.#f(e)}async renderMidiFromUrl(t){let e=await CoreProcessor.#d(t);return this.renderMidiFromMei(e)}renderCurrentMidi(){if(!this.#c)throw Error("MEI データがロードされていません。");let t=this.#a.renderToMIDI();return CoreProcessor.#f(t)}getPageCount(){return this.#a.getPageCount()}}